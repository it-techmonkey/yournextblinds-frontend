generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// PRODUCT MODELS
// ============================================

model Product {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  description String?  @db.Text
  brand       String?
  
  // Pricing
  price          Decimal  @db.Decimal(10, 2)
  originalPrice  Decimal? @db.Decimal(10, 2)
  currency       String   @default("USD")
  
  // Stock & Availability
  stockStatus    StockStatus @default(IN_STOCK)
  sku            String?
  
  // SEO & URLs
  canonicalUrl String?
  metaTitle    String?
  metaDescription String? @db.Text
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishedAt DateTime @default(now())
  
  // Relations
  images                ProductImage[]
  categories            ProductCategory[]
  tags                  ProductTag[]
  reviews               Review[]
  productCustomizations ProductCustomization[]
  
  @@index([slug])
  @@index([stockStatus])
  @@index([createdAt])
}

model ProductImage {
  id         String  @id @default(cuid())
  productId  String
  url        String
  alt        String?
  position   Int     @default(0)
  type       MediaType @default(IMAGE)
  
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@index([position])
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?  @db.Text
  image       String?
  position    Int      @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  products ProductCategory[]
  
  @@index([slug])
}

model ProductCategory {
  productId  String
  categoryId String
  
  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  @@id([productId, categoryId])
  @@index([productId])
  @@index([categoryId])
}

model Tag {
  id   String @id @default(cuid())
  name String @unique
  slug String @unique
  
  products ProductTag[]
  
  @@index([slug])
}

model ProductTag {
  productId String
  tagId     String
  
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)
  
  @@id([productId, tagId])
  @@index([productId])
  @@index([tagId])
}

// ============================================
// CUSTOMIZATION MODELS
// ============================================

model Customization {
  id          String  @id @default(cuid())
  name        String  @unique // e.g., "Headrail", "Bottom Weight Chain"
  label       String // Display name
  description String? @db.Text
  type        CustomizationType @default(SELECTOR)
  
  // Display settings
  position    Int     @default(0)
  icon        String?
  isRequired  Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  options               CustomizationOption[]
  productCustomizations ProductCustomization[]
  
  @@index([name])
  @@index([position])
}

model CustomizationOption {
  id              String  @id @default(cuid())
  customizationId String
  
  name        String // e.g., "Classic Headrail", "Platinum Headrail"
  label       String // Display name
  description String? @db.Text
  
  // Pricing
  price          Decimal  @default(0) @db.Decimal(10, 2)
  priceType      PriceType @default(FIXED)
  
  // Visual
  image          String?
  color          String? // Hex code for color options
  icon           String?
  
  // Nesting - for nested customizations
  parentOptionId String? // References another CustomizationOption
  
  // Display
  position       Int     @default(0)
  isDefault      Boolean @default(false)
  isAvailable    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  customization   Customization           @relation(fields: [customizationId], references: [id], onDelete: Cascade)
  parentOption    CustomizationOption?    @relation("NestedOptions", fields: [parentOptionId], references: [id], onDelete: Cascade)
  childOptions    CustomizationOption[]   @relation("NestedOptions")
  
  @@index([customizationId])
  @@index([parentOptionId])
  @@index([position])
  @@index([isAvailable])
}

model ProductCustomization {
  id              String  @id @default(cuid())
  productId       String
  customizationId String
  
  // Product-specific settings
  isRequired      Boolean @default(false)
  isVisible       Boolean @default(true)
  position        Int     @default(0)
  
  product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  customization Customization @relation(fields: [customizationId], references: [id], onDelete: Cascade)
  
  @@unique([productId, customizationId])
  @@index([productId])
  @@index([customizationId])
}

// ============================================
// REVIEW MODELS
// ============================================

model Review {
  id        String  @id @default(cuid())
  productId String
  
  author   String
  email    String?
  rating   Int     // 1-5
  title    String?
  content  String  @db.Text
  verified Boolean @default(false)
  
  // Moderation
  isApproved Boolean  @default(false)
  isVisible  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@index([rating])
  @@index([isApproved])
  @@index([createdAt])
}

// ============================================
// ENUMS
// ============================================

enum StockStatus {
  IN_STOCK
  OUT_OF_STOCK
  LOW_STOCK
  PRE_ORDER
  DISCONTINUED
}

enum MediaType {
  IMAGE
  VIDEO
}

enum CustomizationType {
  SELECTOR      // Radio/Image selector (e.g., Headrail)
  DROPDOWN      // Dropdown menu
  SIZE_INPUT    // Width/Height inputs
  COLOR_PICKER  // Color selection
  TEXT_INPUT    // Custom text
  CHECKBOX      // Multiple selection
}

enum PriceType {
  FIXED         // Fixed additional price (e.g., +Â£50)
  PERCENTAGE    // Percentage of base price (e.g., +10%)
  FREE          // No additional cost
}
